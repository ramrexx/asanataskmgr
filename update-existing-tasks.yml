---
- name: Check to see if Asana task exists
  uri:
    url: "{{ asana_api }}/projects/{{asana_project_id}}/tasks"
    headers:
      Content-Type: application/json
      Authorization: "{{asana_token}}"
    method: GET
    body_format: json
    validate_certs: "{{ validate_certs }}"
    status_code: 200
  register: project_tasks

- name: Set the task_id
  vars:
    task_name: "{{customer_name}}|{{opp_number}}|opp_name"
    nquery: "[? name==`{{task_name}}`]"
  set_fact:
    task_gid: "{{item.gid}}"
  with_items: "{{project_tasks.json.data|json_query(nquery)}}"

- name: test
  debug:
    var: task_gid
